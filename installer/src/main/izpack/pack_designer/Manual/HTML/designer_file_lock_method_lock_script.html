<!DOCTYPE html>
<html>
<head>
   <title>Script to lock files</title>
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, minimum-scale=1" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="content-language" content="en-us" />
   <meta name="description" content="Description With a lock script the user may implement its own locking method using Java. The script has to be written in Java. Actually it is the implementation of the method..." />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link id="tabscheme" type="text/css" href="hm_topic.css" rel="stylesheet" />   
<style type="text/css">
/* No header topics */

/* Breadcrumb trail */
p#breadcrumbs {
font-family: Verdana, Tahoma, Helvetica, Sans-Serif;   padding: 2px 0 1px 2px;
   margin: 0;
   font-size: 8pt; 
   color: #999;
   }   
p#breadcrumbs a { color: #999; text-decoration: none;}
p#breadcrumbs a:visited {color: #999;}
p#breadcrumbs a:hover { color: #333; border-bottom: 1px dotted #333; }

/* Search hightlight color */
span.highlight {background-color: #ffff40;}
</style>
<script type="text/javascript">
var hmHeaderTopic = true;

</script> 
<!--[if IE 9]>
<link id="iesvgcss" rel="stylesheet" type="text/css" href="hm_webhelp_svg.css" />
<![endif]-->	
<script src="jquery.js"></script>
<script type="text/javascript" src="jquery.tools.min.js"></script>
<script type="text/javascript" src="jquery.scrollTo-min.js"></script>
<script type="text/javascript"> 
// General topic variables
var tVars = {
   hmHelpPage: "index.html",
   nextP: "environment-entries.html",
   prevP: "designer_file_lock_method_check_lock_file.html",
   currP: "designer_file_lock_method_lock_script.html",
   descr: "Description With a lock script the user may implement its own locking method using Java. The script has to be written in Java. Actually it is the implementation of the method...",
   keys: "",
   defP: "designer_channel_file_locking.html",
   mailUrl: "",
   mailUrlQuery: "",
   projectTitle: "Documentation",
   titleP: "Script to lock files",
   mailsubject: "Your feedback: Documentation - Script to lock files",
   sharesubject: "Documentation - Script to lock files",
   simplesubject: "Documentation%20Feedback",
   mailid: "designer_file_lock_method_Lock_script",
   mailpath: "Orchestra Documentation &gt; Reference Manual &gt; Designer Reference &gt; Scenario Elements &gt; Channels &gt; File locking &gt; Script to lock files /",
   mailbody: "",
   fbtype: false,
   header: true,
   background: "spacer.gif",
   tablesReady: false,
   togglesReady: false,
   webRedirect: true,
   topicTitleBar: true,
   titleBarContent: "topic",
   printFooter: true,
   zoomTip: "Click here to view image in its original size",
   autoPrint: true,
   printButton: "Print",
   printButtonTip: "Print topic"
   }
// Popup configuration
 var hmpBShadow = true;
 var hmPopSmallDim = 500;
 var hmPopKillVideo = true;
 // AutoTOC variables
 var hmatocvars = {
   atoc_show: true,
   atoc_title: "Topic content",
   atoc_tip: "Navigate to:&nbsp;",
   atoc_minHeaders: 3,
   atoc_btntip_off: "No topiv headers on this site",
   atoc_btntip_on: "Show/hide topic menu",
   atoc_toptip: "Navigate to beginning of page",
   atoc_top: "Beginning of page",
   atoc_bg: "#f6f6f6",
   atoc_border: "silver",
   atoc_linkcolor: "#444",
   atoc_linklimit: 45,
   atoc_hovercolor: "#000",
   atoc_hoverbgcolor: "#e0e0e0"
}
// Sortable tables
var sortVars = {
   europeandate: false,
   germanNumbers: false,
   imagePath: "",
   image_up: "arrow-up.gif",
   image_down: "arrow-down.gif",
   image_empty: "arrow-empty.gif",
   image_none: "arrow-none.gif",
   sort_tip: "Click here to sort column",
   umlauts: "false"
   }

</script>


<script type="text/javascript" src="helpman_settings.js"></script>
<script type="text/javascript" src="helpman_topicinit.js"></script>
<script type="text/javascript" src="hmtopic.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "designer_file_lock_method_lock_script.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>
<!-- Help & Manual Premium Pack templates by Tim Green, Copyright (c) 2011-2014, All Rights Reserved -->
<!--ZOOMSTOP-->



<ul id="topictabs" class="tabs">
<li id="indextab" class="hmtabs"><a href="#" id="indextablink" class="current"><span>Script to lock files</span></a></li>
</ul>
<div id="hmbox">
<div id="hmheader">
<div id="hmheadercontents">
<p id="breadcrumbs" class="sync-toc">
<b><span class="sync-toc"><a rel="nofollow" class="sync-toc-link" href="index.html?designer_file_lock_method_lock_script.html" target="_top">&lt;&lt;&nbsp;Click here for table of contents&nbsp;&gt;&gt;</a>&nbsp;&nbsp;</span></b></p> 
<h1 class="p_Heading1"><span class="f_Heading1">Script to lock files</span></h1>

</div>
<div id="atocIcon" class="navdivs">
<img class="navicon" id="hmAtocLink" src="contents_off.png" alt="No topiv headers on this site" title="No topiv headers on this site" />
<br /><span>Topic content</span>
</div>
</div>
<div id="autoTocWrapper" class="topicmenu"></div>
<div id="idcontent">
<div id="unclicker"></div>
<!--ZOOMRESTART-->
<h2 class="p_Heading2"><span class="f_Heading2">Description</span></h2>
<p class="p_Normal">With a lock script the user may implement its own locking method using Java. The script has to be written in Java. Actually it is the implementation of the method <span class="f_Emphasize">lockFile</span> in a generated class extending the abstract base class <span class="f_Emphasize">AbstractFileLockFactory</span>.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;public abstract class AbstractFileLockFactory {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">public OrchestraFile directory;</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">public boolean exists(String filename) throws IOException {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">OrchestraFile file = directory.createEntry(filename);</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">return file.exists();</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">}</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">public void delete (String filename) throws IOException {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">OrchestraFile file = directory.createEntry(filename);</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">file.delete();</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">}</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">abstract protected Lock lockFile (String filename)</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">throws EpiBaseException, IOException;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;}</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_Normal">That means within the lock script the current directory is accessible and the script may use the methods <span class="f_Emphasize">exists</span> and <span class="f_Emphasize">delete</span>. &nbsp;Furthermore it may call all Methods of the interface <span class="f_Emphasize">OrchestraFile</span>.</p>
<p class="p_Normal">The method <span class="f_Emphasize">lockFile</span> returns an instance of the Interface <span class="f_Emphasize">Lock</span>:</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;public interface Lock {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">void release () throws IOException;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;}</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_Normal">The method <span class="f_Emphasize">release</span> is called when the channel releases the file. Currently there are two implementations of the interface, Lockfile and StreamLock:</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;public class LockFile implements Lock {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">private OrchestraFile lockedFile;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">public LockFile (OrchestraFile locked) {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">this.lockedFile = locked;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">}</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">public void release() throws IOException {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">lockedFile.delete();</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">}</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;}</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;public class StreamLock implements Lock {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">static final private Logger logger = Logger.getLogger(&quot;emds.runtime.file&quot;);</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">private final String lockFileName;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">private final Closeable lockedStream;</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">public StreamLock(String lockFileName, Closeable lockedStream) {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">this.lockFileName = lockFileName;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">this.lockedStream = lockedStream;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">}</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">public void release() throws IOException {</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">logger.fine(&quot;close locked stream for &quot; + lockFileName);</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_CodeExample">lockedStream.close();</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span style="width:48px;display:inline-block">&nbsp;</span><span class="f_CodeExample">}</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;}</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_Normal">So you may use these classes in your lock script.</p>
<h2 class="p_Heading2"><span class="f_Heading2">Configuration</span></h2>
<p class="p_Normal">To configure the method click on the button labeled with three dots.</p>
<p class="p_Normal"><img alt="designer_file_lock_config_Lock_script" width="375" height="403" style="margin:0;width:375px;height:403px;border:none" src="designer_file_lock_config_lock_script.png"/></p>
<p class="p_Normal">Here the user may enter its lock script. Click on the button <span class="f_buttonslabelsetc">Validate</span> to check if the java source code is valid.</p>
<p class="p_Normal">You also can configure the number of lock tries and the duration between retries. Note that the duration is given in milliseconds and that the duration is doubled each time but no longer than one minute. So in the example above, after the second try it waits 200 ms, than 800 ms and so on.</p>
<p class="p_Subheading"><span class="f_Subheading">Example for a lock script</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> </span>Above you see an example of a lock script. Basically it does the same as the method <a href="designer_file_lock_method_check_lock_file.html" class="topiclink">Check and create lock file</a> already does.<br />
 &nbsp;For the generated class the following default imports are already done:</p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;import emds.epi.impl.landscapedirectory.OrchestraFile;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;import emds.epi.decl.exceptions.EpiBaseException;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;import java.io.IOException;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;import emds.epi.impl.adapter.file.lock.LockFile;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample"> &nbsp; &nbsp;import emds.epi.impl.adapter.file.lock.Lock;</span></p>
<p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;</span></p>

<!--ZOOMSTOP-->


</div> <!-- idcontent -->
</div><!-- hmbox --> 
</body>
</html>
